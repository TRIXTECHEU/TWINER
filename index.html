<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <title>Obrázkové pozadí</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
  
      body {
        background-image: url('https://i.imgur.com/gDyrHmT.png'); /* nahraď cestou k tvému obrázku */
        background-size: cover;      /* roztáhne obrázek přes celou obrazovku */
        background-position: center; /* zarovnání na střed */
        background-repeat: no-repeat;
      }
    </style>
  </head>
  <body>
  <!-- ========== 2) CTA karta (proaktivní zpráva) ========== -->
  <div class="vf-cta" id="vfCta" aria-live="polite">
    <div class="vf-card">
      <button class="vf-close" id="vfCtaClose" aria-label="Skrýt">×</button>
      <div class="vf-header">
        <img class="vf-avatar" src="https://i.imgur.com/2XgF91f.jpeg" alt="AI asistent Twiner">
        <strong class="vf-title"><span class="vf-title-accent">AI asistent</span> <span class="vf-title-rest">Twiner</span></strong>
      </div>
      <p class="vf-desc">Nevíte si rady? Ráda vám pomůžu najít to, co hledáte!</p>
      <button id="vfOpenChat" class="vf-btn" aria-label="Otevřít chatbota">
        <span class="vf-label">Poraď mi</span>
      </button>
    </div>
  </div>

  <style>
    /* Používáme Google font Poppins viz <link> v <head> */
    :root{
      /* sjednocené brand hodnoty */
      --vf-brand:#FF4F00;
      --vf-accent:#7437F6;
      --vf-text:#435875;
      --vf-bg:#fff;
      --vf-card-w: 200px;
      --vf-avatar: 26px;
      --vf-launcher-size:72px;
      --vf-gap:28px;
    }
    .vf-cta{
      position:fixed; right:24px; bottom:95px;
      z-index:2147483000; font-family:'Poppins', system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      opacity:0; transform:translateY(10px) scale(.98); visibility:hidden; pointer-events:none;
      transition:opacity .22s ease, transform .22s ease, visibility 0s linear .22s;
    }
    .vf-cta.is-in{ opacity:1; transform:translateY(0) scale(1); visibility:visible; pointer-events:auto; }
    .vf-cta.is-out{ opacity:0; transform:translateY(8px) scale(.98); visibility:hidden; pointer-events:none; transition:opacity .18s ease, transform .18s ease, visibility 0s linear .18s; }
    .vf-card{
      position:relative; width:var(--vf-card-w);
      background:#fff; color:var(--vf-text);
      border:1px solid rgba(0,0,0,.08);
      border-radius:20px;
      padding:14px;
      /* min-height odstraněna pro kompaktní výšku podle obsahu */
      box-shadow:0 8px 20px rgba(0,0,0,.14);
    }
    .vf-header{ display:flex; flex-direction:row; align-items:center; gap:4px; margin-bottom:12px; }
    .vf-avatar{ width:28px; height:28px; flex:0 0 28px; border-radius:999px; object-fit:cover; background:#FF4F00; border:2px solid #FF4F00; box-shadow:none; transform: translateX(-4px); }
    .vf-title{ font-size:16px; font-weight:700; line-height:1.1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; transform: translateX(-1px); }
    .vf-title-accent{ color:#FF4F00; }
    .vf-title-rest{ color:#1a1e23; }
    .vf-desc{ margin:15px 0 15px 0; font-size:14px; line-height:1.35; color:var(--vf-text); opacity:.95; }
    .vf-btn{ margin:8px 0 0 0; padding:10px 16px; border:0; border-radius:10px; background:#FF4F00; color:#fff; font-weight:bold; font-size:15px; cursor:pointer; display:grid; grid-template-columns:1fr; align-items:center; justify-items:center; width:100%; max-width:none; box-shadow:none; position:relative; overflow:hidden; backface-visibility:hidden; -webkit-font-smoothing:antialiased; transform:translateZ(0); }
    .vf-btn::before{ content:""; position:absolute; inset:0; background:linear-gradient(95deg, var(--vf-brand) 0%, var(--vf-accent) 100%); opacity:0; transition:opacity .15s ease; will-change:opacity; }
    .vf-btn:hover::before{ opacity:1; }
    .vf-btn > *{ position:relative; z-index:1; }
    .vf-label{ font-weight:bold; }
    .vf-btn:active{ transform:translateY(0) }
    .vf-close{ position:absolute; top:-10px; right:-10px; width:24px; height:24px; border-radius:999px; border:1px solid rgba(0,0,0,.12); background:#fff; color:#333; cursor:pointer; font-size:14px; line-height:1; display:grid; place-items:center; box-shadow:0 4px 12px rgba(0,0,0,.14); }
    @media (max-width:520px){ .vf-cta{ right:12px; bottom:calc(var(--vf-launcher-size) + 18px) } .vf-card{ width:88vw; } }
  </style>

  <script>
    // CTA zobrazení + globální schování
    const ctaEl = document.getElementById('vfCta');
    const showDelayMs = 3500;
    const reShowDelayMs = 8000; // po zavření chatu znovu ukázat CTA po 8s
    const isCtaDismissed = () => { try { return sessionStorage.getItem('vf_cta_dismissed') === '1'; } catch { return false; } };
    let ctaDismissedByUser = isCtaDismissed(); // pokud uživatel klikne na křížek, už nevracet v rámci relace

    const isWidgetVisible = () => {
      const w = document.querySelector('.vfrc-widget');
      if (!w) return false;
      if (getComputedStyle(w).display === 'none') return false;
      const dialog = w.querySelector('[role="dialog"], .vfrc-chat__dialog, .vfrc-chat');
      if (dialog) {
        const style = getComputedStyle(dialog);
        if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') return false;
      }
      return true;
    };

    // Varianty obsahu CTA podle stavu
    const pageLoadTs = Date.now();
    const VARIANTS = {
      default: {
        title: 'AI asistent Twiner',
        desc: 'Nevíte si rady? Rád vám pomůžu najít to, co hledáte!',
        cta: 'Poraď mi'
      },
      returning: {
        title: 'Pokračujeme?',
        desc: 'Můžu navázat tam, kde jsme skončili. Otevřít chat a pokračovat?',
        cta: 'Navázat v chatu'
      }
    };

    function pickVariant() {
      const lastOpen = Number((() => { try { return sessionStorage.getItem('vf_last_open_ts'); } catch { return 0; } })() || 0);
      const now = Date.now();
      if (lastOpen && (now - lastOpen) < 10 * 60 * 1000) return 'returning';
      return 'default';
    }

    function renderVariant(variantKey) {
      const v = VARIANTS[variantKey] || VARIANTS.default;
      const titleRoot = document.querySelector('.vf-title');
      const titleAccent = document.querySelector('.vf-title-accent');
      const titleRest = document.querySelector('.vf-title-rest');
      const descEl = document.querySelector('.vf-desc');
      const btnEl = document.getElementById('vfOpenChat');
      const labelEl = btnEl ? btnEl.querySelector('.vf-label') : null;

      if (titleAccent && titleRest) {
        if (v.title && v.title.includes('AI asistent ') && v.title.trim().endsWith('Twiner')) {
          titleAccent.textContent = 'AI asistent';
          titleRest.textContent = 'Twiner';
        } else if (v.title) {
          titleAccent.textContent = v.title;
          titleRest.textContent = '';
        }
      } else if (titleRoot && v.title) {
        titleRoot.textContent = v.title;
      }

      if (descEl) descEl.textContent = v.desc;
      if (labelEl) labelEl.textContent = v.cta;
    }

    function showCTA() {
      if (isWidgetVisible()) return; // nikdy nezobrazuj, když je widget otevřený
      renderVariant(pickVariant());
      ctaEl.style.display='';
      ctaEl.classList.remove('is-out');
      ctaEl.classList.add('is-in');
      ctaEl.removeAttribute('aria-hidden');
    }

    const suppressCTA = () => {
      window.__hideCustomCTA?.();
      try { sessionStorage.setItem('vf_open', '1'); } catch {}
      window.__vfIsOpen = true;
    };
    const releaseCTA = () => {
      try { sessionStorage.removeItem('vf_open'); } catch {}
      window.__vfIsOpen = false;
    };

    const alreadyOpen = (() => {
      if (window.__vfIsOpen) return true;
      try { return sessionStorage.getItem('vf_open') === '1'; } catch { return false; }
    })();

    let showTimer = setTimeout(() => {
      if (!alreadyOpen && !isWidgetVisible() && !isCtaDismissed()) showCTA();
    }, showDelayMs);

    window.__hideCustomCTA = function hideCTA(){
      if (showTimer) { clearTimeout(showTimer); showTimer = null; }
      if (!ctaEl || ctaEl.classList.contains('is-out')) return;
      ctaEl.classList.add('is-out');
      const done = () => { ctaEl.style.display = 'none'; ctaEl.setAttribute('aria-hidden','true'); ctaEl.removeEventListener('transitionend', done); };
      ctaEl.addEventListener('transitionend', done);
      setTimeout(done, 450);
    };

    document.getElementById('vfOpenChat')?.addEventListener('click', () => {
      window.__hideCustomCTA();
      if (window.voiceflow?.chat?.open) window.voiceflow.chat.open();
      else window.__vfOpenAfterLoad = true;
    });
    document.getElementById('vfCtaClose')?.addEventListener('click', () => {
      ctaDismissedByUser = true; try { sessionStorage.setItem('vf_cta_dismissed','1'); } catch {}
      window.__hideCustomCTA();
    });

    // Zachyť systémové open/close eventy (postMessage)
    window.addEventListener('message', (e) => {
      let data = e.data;
      if (typeof data === 'string') {
        try { data = JSON.parse(data); } catch { /* ignore */ }
      }
      if (!data) return;
      const type = data.type || data.event;
      if (type === 'voiceflow:open') suppressCTA();
      if (type === 'voiceflow:close') {
        releaseCTA();
        if (!ctaDismissedByUser && !isCtaDismissed()) {
          // znovu zobraz CTA po prodlevě, pouze pokud je widget opravdu zavřený
          setTimeout(() => { if (!isWidgetVisible()) { showCTA(); } }, reShowDelayMs);
        }
      }
    });

    // Reálné zobrazení widgetu (DOM/atributy) – skryj CTA okamžitě a zruš timer
    const observer = new MutationObserver(() => {
      if (isWidgetVisible()) suppressCTA();
    });
    observer.observe(document.documentElement, { childList: true, subtree: true, attributes: true, attributeFilter: ['style', 'class'] });

    // Watchdog: pravidelně kontroluj, jestli je widget otevřený – CTA nesmí být vidět
    const ctaWatchdog = setInterval(() => {
      if (isWidgetVisible()) window.__hideCustomCTA?.();
    }, 1000);
    window.addEventListener('pagehide', () => clearInterval(ctaWatchdog));
  </script>
 <!-- AI chatbot -->
 <script>
  ['LoadingAnimationExtention.js'].forEach(name => {
    document.write(`<script src="https://trixtecheu.github.io/TWINER/Extentions/${name}"><\/script>`);
  });
</script>
<script src="./SelectExtention.js"></script>
<script type="text/javascript">
  (function(d, t) {
    const v = d.createElement(t),
          s = d.getElementsByTagName(t)[0];

    v.onload = () => {
      window.voiceflow.chat.load({
        verify:    { projectID: '683439dce3e4ba215ad220d5' },
        url:       'https://general-runtime.voiceflow.com',
        versionID: 'production',
        render:    { mode: 'overlay' },
        assistant: {
          stylesheet:'styles.css',
          extensions: [
            window.LoadingAnimationExtention,
            window.SelectExtention
          ]
        }
      }).then(() => {
        const chat = window.voiceflow.chat;

        // Fallback: pokud někdo klikl dřív na CTA
        if (window.__vfOpenAfterLoad) { chat.open(); window.__vfOpenAfterLoad = false; }

        // Jakékoliv chat.open() => skryj CTA
        if (chat?.open && !chat.__patchedOpen) {
          const _open = chat.open.bind(chat);
          chat.open = (...args) => { window.__hideCustomCTA?.(); return _open(...args); };
          chat.__patchedOpen = true;
        }

        // Klik na launcher (ve shadow DOM) => skryj CTA
        document.addEventListener('click', (ev) => {
          const path = ev.composedPath ? ev.composedPath() : [];
          if (path.some(n => n?.classList?.contains?.('vfrc-launcher') || n?.classList?.contains?.('vfrc-button--launcher'))) {
            window.__hideCustomCTA?.();
          }
        }, true);

        // Pokud je widget už zobrazený (např. si pamatuje stav), skryj CTA
        const w = document.querySelector('.vfrc-widget');
        if (w && getComputedStyle(w).display !== 'none') window.__hideCustomCTA?.();
      });
    };
    v.src  = "https://cdn.voiceflow.com/widget-next/bundle.mjs";
    v.type = "text/javascript";
    s.parentNode.insertBefore(v, s);
  })(document, 'script');
</script>
<!-- TrixTech s.r.o. @2025 -->
  </body>
</html>
